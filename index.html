<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Starting Strength Memphis | Protein Order Form</title>
    <style>
        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f8f8;
            color: #333;
        }
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        h1 {
            color: #222;
        }
        .logo {
            font-weight: bold;
            font-size: 28px;
            margin-bottom: 5px;
        }
        .form-container {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .form-section {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eee;
        }
        .form-section:last-child {
            border-bottom: none;
        }
        h2 {
            color: #444;
            margin-bottom: 15px;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            font-size: 16px;
        }
        .product-item {
            display: grid;
            grid-template-columns: 100px 1fr 120px 120px;
            grid-gap: 15px;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            background-color: #f9f9f9;
            transition: background-color 0.2s;
            position: relative;
        }
        .product-item:hover {
            background-color: #f0f0f0;
        }
        .product-image {
            width: 100px;
            height: 100px;
            object-fit: contain;
            background-color: white;
            border-radius: 4px;
            border: 1px solid #eee;
        }
        .product-info {
            display: flex;
            flex-direction: column;
        }
        .product-flavor {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 4px;
        }
        .product-type {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .product-size-selector {
            margin-top: 8px;
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .size-option {
            background-color: #fff;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .size-option.active {
            background-color: #e63946;
            color: white;
            border-color: #e63946;
        }
        .nutrition-link {
            color: #e63946;
            cursor: pointer;
            text-decoration: underline;
            font-size: 14px;
        }
        .product-price {
            color: #e63946;
            font-weight: bold;
            font-size: 18px;
            text-align: center;
        }
        .product-quantity {
            text-align: center;
        }
        input[type="number"] {
            width: 70px;
            text-align: center;
        }
        button {
            background-color: #e63946;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: background-color 0.3s;
        }
        button:hover {
            background-color: #d62a38;
        }
        #response-container {
            margin-top: 20px;
            padding: 15px;
            border-radius: 4px;
            display: none;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #e63946;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            animation: spin 2s linear infinite;
            display: inline-block;
            margin-right: 10px;
            vertical-align: middle;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .summary {
            margin-top: 20px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 6px;
        }
        .summary-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding-bottom: 8px;
            border-bottom: 1px solid #eee;
        }
        .summary-row:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .total-row {
            font-weight: bold;
            font-size: 18px;
            margin-top: 10px;
            padding-top: 10px;
            border-top: 2px solid #ddd;
        }
        .required-field::after {
            content: " *";
            color: #e63946;
        }
        .product-category {
            font-weight: bold;
            margin: 20px 0 10px 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #eee;
            font-size: 18px;
        }
        .product-size-info {
            font-size: 12px;
            color: #666;
            margin-top: 4px;
        }
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            overflow: auto;
        }
        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 20px;
            border-radius: 8px;
            width: 80%;
            max-width: 800px;
            position: relative;
        }
        .close-modal {
            position: absolute;
            right: 20px;
            top: 15px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: #666;
        }
        .nutrition-image {
            width: 100%;
            max-height: 80vh;
            object-fit: contain;
        }
        .modal-title {
            margin-top: 0;
            padding-right: 30px;
        }
        
        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            body {
                padding: 10px;
            }
            .form-container {
                padding: 15px;
            }
            .product-item {
                grid-template-columns: 1fr;
                grid-gap: 10px;
                text-align: center;
            }
            .product-image {
                width: 80px;
                height: 80px;
                margin: 0 auto;
            }
            .product-info {
                text-align: center;
            }
            .product-size-selector {
                justify-content: center;
            }
            .product-price, .product-quantity {
                text-align: center;
                margin-top: 10px;
            }
            h1 {
                font-size: 24px;
            }
            .logo {
                font-size: 20px;
            }
            .modal-content {
                width: 95%;
                margin: 10% auto;
            }
        }
        
        /* Tablet Responsive Styles */
        @media (min-width: 769px) and (max-width: 991px) {
            .product-item {
                grid-template-columns: 80px 1fr 100px 80px;
            }
            .product-image {
                width: 80px;
                height: 80px;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">STARTING STRENGTH MEMPHIS</div>
        <h1>Ascent Protein Order Form</h1>
    </header>
    
    <div class="form-container">
        <form id="protein-order-form">
            <div class="form-section">
                <h2>Your Information</h2>
                <div class="form-group">
                    <label for="name" class="required-field">Name</label>
                    <input type="text" id="name" name="name" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email (Optional)</label>
                    <input type="email" id="email" name="email">
                </div>
            </div>
            
            <div class="form-section">
                <h2>Products</h2>
                
                <div class="product-category">Whey Protein</div>
                
                <div class="product-item">
                    <img src="./Images/vanilla-main.jpeg" alt="Vanilla Whey" class="product-image" data-product-image="./Images/vanilla-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Vanilla Bean</div>
                        <div class="product-type">Whey Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="40.00">2 lb - $40.00</div>
                            <div class="size-option" data-size="4lb" data-price="70.00">4 lb - $70.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/vanilla-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="vanilla-qty" min="0" value="0" class="quantity-input" data-product="Vanilla Bean Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>
                
                <div class="product-item">
                    <img src="./Images/chocolate-main.jpeg" alt="Chocolate Whey" class="product-image" data-product-image="./Images/chocolate-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Chocolate</div>
                        <div class="product-type">Whey Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="40.00">2 lb - $40.00</div>
                            <div class="size-option" data-size="4lb" data-price="70.00">4 lb - $70.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/chocolate-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="chocolate-qty" min="0" value="0" class="quantity-input" data-product="Chocolate Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>
                
                <div class="product-item">
                    <img src="./Images/strawberry-main.jpeg" alt="Strawberry Whey" class="product-image" data-product-image="./Images/strawberry-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Strawberry</div>
                        <div class="product-type">Whey Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="40.00">2 lb - $40.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/strawberry-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="strawberry-qty" min="0" value="0" class="quantity-input" data-product="Strawberry Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>
                
                <div class="product-item">
                    <img src="./Images/chopeanutbutter-main.jpeg" alt="Chocolate Peanut Butter Whey" class="product-image" data-product-image="./Images/chopeanutbutter-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Chocolate Peanut Butter</div>
                        <div class="product-type">Whey Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="40.00">2 lb - $40.00</div>
                            <div class="size-option" data-size="4lb" data-price="70.00">4 lb - $70.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/chopeanutbutter-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="choc-pb-qty" min="0" value="0" class="quantity-input" data-product="Chocolate Peanut Butter Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>
                
                <div class="product-item">
                    <img src="./Images/cookiescream-main.jpeg" alt="Cookies and Cream Whey" class="product-image" data-product-image="./Images/cookiescream-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Cookies and Cream</div>
                        <div class="product-type">Whey Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="44.99">2 lb - $40.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/cookiescream-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="cookies-qty" min="0" value="0" class="quantity-input" data-product="Cookies and Cream Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>
                
                <div class="product-item">
                    <img src="./Images/mochacoldbrew-main.jpeg" alt="Mocha Cold Brew Whey" class="product-image" data-product-image="./Images/mochacoldbrew-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Mocha Cold Brew</div>
                        <div class="product-type">Whey Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="40.00">2 lb - $40.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/mochacoldbrew-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="mocha-qty" min="0" value="0" class="quantity-input" data-product="Mocha Cold Brew Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>
                
                <div class="product-item">
                    <img src="./Images/unflavored-main.jpeg" alt="Unflavored Whey" class="product-image" data-product-image="./Images/unflavored-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Unflavored</div>
                        <div class="product-type">Whey Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="44.99">2 lb - $40.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/unflavored-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="unflavored-qty" min="0" value="0" class="quantity-input" data-product="Unflavored Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>
                
                <div class="product-item">
                    <img src="./Images/icedcoffee-main.jpeg" alt="Iced Coffee Whey" class="product-image" data-product-image="./Images/icedcoffee-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Iced Coffee</div>
                        <div class="product-type">Whey Protein</div>
                        <div class="product-size-info">15 servings</div>
                        <div class="nutrition-link" data-nutrition="./Images/Iced-Coffee-Nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">30.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="iced-coffee-qty" min="0" value="0" class="quantity-input" data-product="Iced Coffee Whey" data-price="30.00" data-size="15 servings">
                    </div>
                </div>

                <div class="product-category">Casein Protein</div>

                <div class="product-item">
                    <img src="./Images/vanillabean-casein-main.jpeg" alt="Vanilla Bean Casein Whey" class="product-image" data-product-image="./Images/vanillabean-casein-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Vanilla Bean</div>
                        <div class="product-type">Casein Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="40.00">2 lb - $40.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/vanillabean-casein-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="vanilla-casein-qty" min="0" value="0" class="quantity-input" data-product="Vanilla Casein Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>

                <div class="product-item">
                    <img src="./Images/chocolate-casein-main.jpeg" alt="Chocolate Casein Whey" class="product-image" data-product-image="./Images/chocolate-casein-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Chocolate</div>
                        <div class="product-type">Casein Protein</div>
                        <div class="product-size-selector">
                            <div class="size-option active" data-size="2lb" data-price="40.00">2 lb - $40.00</div>
                        </div>
                        <div class="nutrition-link" data-nutrition="./Images/chocolate-casein-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">40.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="chocolate-casein-qty" min="0" value="0" class="quantity-input" data-product="Chocolate Casein Whey" data-price="40.00" data-size="2lb">
                    </div>
                </div>
                
                <div class="product-category">Vegan Options</div>
                
                <div class="product-item">
                    <img src="./Images/veganvanilla-main.jpeg" alt="Vegan Vanilla Protein" class="product-image" data-product-image="./Images/veganvanilla-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Vegan Vanilla</div>
                        <div class="product-type">Plant-Based Protein</div>
                        <div class="product-size-info">18-20 servings</div>
                        <div class="nutrition-link" data-nutrition="./Images/veganvanilla-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">37.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="vegan-vanilla-qty" min="0" value="0" class="quantity-input" data-product="Vegan Vanilla" data-price="37.00" data-size="18-20 servings">
                    </div>
                </div>

                <div class="product-item">
                    <img src="./Images/veganchocolate-main.jpeg" alt="Vegan Chocolate Protein" class="product-image" data-product-image="./Images/veganchocolate-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Vegan Chocolate</div>
                        <div class="product-type">Plant-Based Protein</div>
                        <div class="product-size-info">18-20 servings</div>
                        <div class="nutrition-link" data-nutrition="./Images/veganchocolate-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">37.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="vegan-chocolate-qty" min="0" value="0" class="quantity-input" data-product="Vegan Chocolate" data-price="37.00" data-size="18-20 servings">
                    </div>
                </div>
                
                <div class="product-category">Pre-Workout & Supplements</div>
                
                <div class="product-item">
                    <img src="./Images/energycitrus-main.jpeg" alt="Clean Hydration + Energy" class="product-image" data-product-image="./Images/energycitrus-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Raspberry Lemonade</div>
                        <div class="product-type">Clean Hydration + Energy</div>
                        <div class="product-size-info">40 servings</div>
                        <div class="nutrition-link" data-nutrition="./Images/energycitrus-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">25.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="energy-rasp-qty" min="0" value="0" class="quantity-input" data-product="Clean Hydration + Energy (Raspberry Lemonade)" data-price="25.00" data-size="40 servings">
                    </div>
                </div>

                <div class="product-item">
                    <img src="./Images/energyorangemango-main.jpeg" alt="Clean Hydration + Energy" class="product-image" data-product-image="./Images/energyorangemango-nutrition.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Orange Mango</div>
                        <div class="product-type">Clean Hydration + Energy</div>
                        <div class="product-size-info">40 servings</div>
                        <div class="nutrition-link" data-nutrition="./Images/energyorangemango-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">25.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="energy-orange-qty" min="0" value="0" class="quantity-input" data-product="Clean Hydration + Energy (Orange Mango)" data-price="25.00" data-size="40 servings">
                    </div>
                </div>

                <div class="product-item">
                    <img src="./Images/unflavored-main.jpeg" alt="Clean Creatine" class="product-image" data-product-image="./Images/unflavored-main.jpeg">
                    <div class="product-info">
                        <div class="product-flavor">Unflavored</div>
                        <div class="product-type">Clean Creatine</div>
                        <div class="product-size-info">45 servings</div>
                        <div class="nutrition-link" data-nutrition="./Images/unflavored-nutrition.jpeg">View Nutrition Facts</div>
                    </div>
                    <div class="product-price">$<span class="price-value">25.00</span></div>
                    <div class="product-quantity">
                        <input type="number" name="creatine-qty" min="0" value="0" class="quantity-input" data-product="Clean Creatine (Unflavored)" data-price="25.00" data-size="45 servings">
                    </div>
                </div>
            </div>
            
            <div class="form-section">
                <h2>Order Summary</h2>
                <div id="order-summary" class="summary">
                    <!-- Summary rows will be populated by JavaScript -->
                </div>
                
                <div class="form-group" style="margin-top: 20px;">
                    <label for="notes">Special Instructions (Optional)</label>
                    <textarea id="notes" name="notes" rows="3" style="width: 100%; padding: 10px;"></textarea>
                </div>
            </div>
            
            <button type="submit" id="submit-button">Place Order</button>
        </form>
    </div>
    
    <div id="response-container"></div>
    
    <!-- Nutrition Facts Modal -->
    <div id="nutrition-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h3 class="modal-title" id="modal-title">Nutrition Facts</h3>
            <img id="nutrition-image" src="" alt="Nutrition Facts" class="nutrition-image">
        </div>
    </div>
    
    <script>
    // Replace with your Google Apps Script Web App URL after deployment
const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyNxjRVCCgEy7a3q5dYh2D2IkytSWfWrGXubP15kkTiTkM8-3gB5Ho-vAx7n1teu-6U/exec';

// Function to update the order summary with tax calculation
function updateOrderSummary() {
    try {
        console.log("Updating order summary...");
        const quantityInputs = document.querySelectorAll('.quantity-input');
        console.log("Found quantity inputs:", quantityInputs.length);
        const summaryElement = document.getElementById('order-summary');
        let subtotal = 0;
        
        // Clear previous summary
        while (summaryElement.firstChild) {
            summaryElement.removeChild(summaryElement.firstChild);
        }
        
        // Add each selected product to summary
        quantityInputs.forEach(input => {
            const quantity = parseInt(input.value) || 0;
            if (quantity > 0) {
                const productName = input.getAttribute('data-product');
                const price = parseFloat(input.getAttribute('data-price')) || 0;
                const size = input.getAttribute('data-size');
                const itemTotal = price * quantity;
                subtotal += itemTotal;
                
                console.log(`Adding to summary: ${quantity} x ${productName} (${size}) at $${price} each = $${itemTotal.toFixed(2)}`);
                
                const summaryRow = document.createElement('div');
                summaryRow.className = 'summary-row';
                summaryRow.innerHTML = `
                    <div>${quantity} × ${productName} (${size})</div>
                    <div>$${itemTotal.toFixed(2)}</div>
                `;
                
                // Add to summary
                summaryElement.appendChild(summaryRow);
            }
        });
        
        // Calculate tax (9.75%)
        const taxRate = 0.0975;
        const tax = subtotal * taxRate;
        
        // Add subtotal row
        if (subtotal > 0) {
            const subtotalRow = document.createElement('div');
            subtotalRow.className = 'summary-row';
            subtotalRow.innerHTML = `
                <div>Subtotal:</div>
                <div>$${subtotal.toFixed(2)}</div>
            `;
            summaryElement.appendChild(subtotalRow);
            
            // Add tax row
            const taxRow = document.createElement('div');
            taxRow.className = 'summary-row';
            taxRow.innerHTML = `
                <div>Sales Tax (9.75%):</div>
                <div>$${tax.toFixed(2)}</div>
            `;
            summaryElement.appendChild(taxRow);
        }
        
        // Calculate total
        const total = subtotal + tax;
        
        // Add total row
        const totalRow = document.createElement('div');
        totalRow.className = 'summary-row total-row';
        totalRow.innerHTML = `
            <div>Total:</div>
            <div>$${total.toFixed(2)}</div>
        `;
        summaryElement.appendChild(totalRow);
        
        console.log(`Subtotal: $${subtotal.toFixed(2)}, Tax: $${tax.toFixed(2)}, Total: $${total.toFixed(2)}`);
    } catch (error) {
        console.error("Error updating summary:", error);
    }
}

// Add event listeners to quantity inputs
document.querySelectorAll('.quantity-input').forEach(input => {
    input.addEventListener('change', updateOrderSummary);
});

// Size selector functionality
document.querySelectorAll('.size-option').forEach(option => {
    option.addEventListener('click', function() {
        try {
            console.log("Size option clicked:", this.textContent);
            // Get parent product item
            const productItem = this.closest('.product-item');
            
            // Remove active class from all size options in this product
            productItem.querySelectorAll('.size-option').forEach(opt => {
                opt.classList.remove('active');
            });
            
            // Add active class to clicked option
            this.classList.add('active');
            
            // Update price display
            const price = this.getAttribute('data-price');
            const priceDisplay = productItem.querySelector('.price-value');
            priceDisplay.textContent = price;
            console.log(`Updated price display to: ${price}`);
            
            // Update quantity input data attributes
            const quantityInput = productItem.querySelector('.quantity-input');
            quantityInput.setAttribute('data-price', price);
            quantityInput.setAttribute('data-size', this.getAttribute('data-size'));
            console.log(`Updated input data: price=${price}, size=${this.getAttribute('data-size')}`);
            
            // Update order summary
            updateOrderSummary();
        } catch (error) {
            console.error("Error in size option click handler:", error);
        }
    });
});

// Modal functionality
const modal = document.getElementById('nutrition-modal');
const modalImage = document.getElementById('nutrition-image');
const modalTitle = document.getElementById('modal-title');
const closeModal = document.querySelector('.close-modal');

// Open modal when clicking on "View Nutrition Facts"
document.querySelectorAll('.nutrition-link').forEach(link => {
    link.addEventListener('click', function() {
        try {
            const nutritionImage = this.getAttribute('data-nutrition');
            const productFlavor = this.parentElement.querySelector('.product-flavor').textContent;
            console.log(`Opening nutrition modal for ${productFlavor}`);
            modalImage.src = nutritionImage;
            modalTitle.textContent = `${productFlavor} - Nutrition Facts`;
            modal.style.display = 'block';
        } catch (error) {
            console.error("Error opening nutrition modal:", error);
        }
    });
});

// Close modal when clicking on X
closeModal.addEventListener('click', function() {
    modal.style.display = 'none';
});

// Close modal when clicking outside the content
window.addEventListener('click', function(event) {
    if (event.target === modal) {
        modal.style.display = 'none';
    }
});

// Form submission handler
document.getElementById('protein-order-form').addEventListener('submit', function(e) {
    e.preventDefault();
    console.log("Form submission started");
    
    // Check if at least one product is selected
    const quantities = document.querySelectorAll('.quantity-input');
    let hasProducts = false;
    
    quantities.forEach(input => {
        if (parseInt(input.value) > 0) {
            hasProducts = true;
        }
    });
    
    if (!hasProducts) {
        const responseContainer = document.getElementById('response-container');
        responseContainer.innerHTML = 'Please select at least one product to order.';
        responseContainer.className = 'error';
        responseContainer.style.display = 'block';
        console.log("Form submission failed: No products selected");
        return;
    }
    
    // Collect form data
    const formData = {
        name: document.getElementById('name').value,
        email: document.getElementById('email').value || 'Not provided',
        notes: document.getElementById('notes').value || 'None',
        products: []
    };
    
    // Add selected products
    let subtotal = 0;
    quantities.forEach(input => {
        const quantity = parseInt(input.value);
        if (quantity > 0) {
            const productItem = input.closest('.product-item');
            const size = input.getAttribute('data-size');
            const price = parseFloat(input.getAttribute('data-price')) || 0;
            const itemTotal = price * quantity;
            subtotal += itemTotal;
            
            formData.products.push({
                product: input.getAttribute('data-product'),
                size: size,
                quantity: quantity,
                price: price,
                itemTotal: itemTotal
            });
            
            console.log(`Added to order: ${quantity} x ${input.getAttribute('data-product')} (${size}) at ${price}`);
        }
    });
    
    // Calculate tax and total
    const taxRate = 0.0975; // 9.75%
    const tax = subtotal * taxRate;
    const total = subtotal + tax;
    
    // Add calculated values to form data
    formData.subtotal = subtotal;
    formData.tax = tax;
    formData.total = total;
    
    console.log(`Order subtotal: ${subtotal.toFixed(2)}, Tax: ${tax.toFixed(2)}, Total: ${total.toFixed(2)}`);
    
    // Disable submit button and show loading
    const submitButton = document.getElementById('submit-button');
    const originalButtonText = submitButton.innerHTML;
    submitButton.disabled = true;
    submitButton.innerHTML = '<div class="loader"></div> Processing...';
    
    console.log("Sending data to server:", formData);
    
    // Send data to Google Sheets
    fetch(SCRIPT_URL, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        mode: 'no-cors', // Add this to help with CORS issues
        body: JSON.stringify(formData)
    })
    .then(response => {
        console.log("Received response from server");
        // Since mode: 'no-cors' doesn't allow reading the response,
        // we'll just assume success if we get this far
        return { result: 'success' };
    })
    .then(data => {
        console.log("Processing successful response");
        // Show success message
        const responseContainer = document.getElementById('response-container');
        responseContainer.innerHTML = 'Your order has been submitted successfully! We will contact you when your supplements are ready for pickup.';
        responseContainer.className = 'success';
        responseContainer.style.display = 'block';
        
        // Reset form
        document.getElementById('protein-order-form').reset();
        updateOrderSummary();
        
        // Reset button
        submitButton.disabled = false;
        submitButton.innerHTML = originalButtonText;
        
        // Scroll to response
        responseContainer.scrollIntoView({ behavior: 'smooth' });
    })
    .catch(error => {
        console.error("Error in form submission:", error);
        // Show error message
        const responseContainer = document.getElementById('response-container');
        responseContainer.innerHTML = 'Error submitting form. Please try again later or contact Starting Strength Memphis directly.';
        responseContainer.className = 'error';
        responseContainer.style.display = 'block';
        
        // Reset button
        submitButton.disabled = false;
        submitButton.innerHTML = originalButtonText;
    });
});

// Initialize the form
document.addEventListener('DOMContentLoaded', function() {
    console.log("Document loaded, initializing form");
    updateOrderSummary();
});


</script>
